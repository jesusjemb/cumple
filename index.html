<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <head>
      <link rel="icon" href="https://i.gifer.com/XDZT.gif" type="image/png" />
    </head>

    <title>El Ultimo Hanneo</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Host Grotesk&display=swap"
      rel="stylesheet"
    />

    <style>
      @property --rotate {
        syntax: "<angle>";
        initial-value: 132deg;
        inherits: false;
      }

      :root {
        --card-height: 65vh;
        --card-width: calc(var(--card-height) / 1.5);
      }

      body {
        background: black;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
        overflow: hidden; /* Elimina la barra de desplazamiento */
      }

      .card {
        background: black;
        width: var(--card-width);
        height: var(--card-height);
        padding: 2vh;
        position: relative;
        border-radius: 6px;
        justify-content: center;
        align-items: center;
        text-align: center;
        display: flex;
        font-size: 1.5em;
        color: rgb(88 199 250 / 0%);
        cursor: pointer;
        font-family: "Host Grotesk", calibri;
        color: rgb(88 199 250 / 100%);
        flex-direction: column;
      }

      #card-container {
        display: flex; /* Usar flex para centrar la carta */
        justify-content: center; /* Centrado horizontal */
        align-items: center; /* Centrado vertical */
        width: 100%;
        height: 100%;
        position: relative;
      }

      .card::before {
        content: "";
        width: 104%;
        height: 102%;
        border-radius: 8px;
        background-image: linear-gradient(
          var(--rotate),
          #5ddcff,
          #3c67e3 43%,
          #4e00c2
        );
        position: absolute;
        z-index: -1;
        top: -1%;
        left: -2%;
        animation: spin 2.5s linear infinite;
      }

      .card::after {
        position: absolute;
        content: "";
        left: 0;
        right: 0;
        z-index: -1;
        height: 100%;
        width: 100%;
        margin: 0 auto;
        transform: scale(1.3);
        filter: blur(calc(var(--card-height) / 6));
        background-image: linear-gradient(
          var(--rotate),
          #5ddcff,
          #3c67e3 43%,
          #4e00c2
        );
        opacity: 1;
        transition: opacity 0.5s;
        animation: spin 2.5s linear infinite;
      }

      @keyframes spin {
        0% {
          --rotate: 0deg;
        }
        100% {
          --rotate: 360deg;
        }
      }

      a {
        color: #212534;
        text-decoration: none;
        font-weight: bold;
        margin-top: 2rem;
      }

      iframe {
        width: 100%;
        height: 50%; /* Ajusta la altura del video */
        border: none;
      }

      #hover-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: transparent;
        pointer-events: none;
      }

      .card-text {
        margin-bottom: 10px; /* Espacio entre el texto y el video */
        padding: 1vh;
        overflow: auto;
      }

      /* Personalizar la barra de scroll */
      .card-text::-webkit-scrollbar {
        width: 10px; /* Ancho de la barra de scroll */
        height: 10px; /* Altura para scroll horizontal */
      }

      /* Estilo del "track" de la barra (el fondo) */
      .card-text::-webkit-scrollbar-track {
        background: #f1f1f1; /* Color de fondo */
        border-radius: 10px; /* Bordes redondeados */
      }

      /* Estilo del "thumb" (la parte desplazable) */
      .card-text::-webkit-scrollbar-thumb {
        background: #888; /* Color del "thumb" */
        border-radius: 10px; /* Bordes redondeados */
      }

      /* Estilo del "thumb" al pasar el mouse */
      .card-text::-webkit-scrollbar-thumb:hover {
        background: #555; /* Color más oscuro al pasar el mouse */
      }
      /* Estilo para la capa oscura */
      .dark-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 1);
        z-index: 999;
        display: none;
        opacity: 0;
      }
      /* Estilo para el contenedor del video */
      .video-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #000;
        padding: 20px;
        border-radius: 8px;
        z-index: 1000;
        display: none;
        justify-content: center;
        align-items: center;
      }

      .video-container iframe {
        width: 80vw;
        height: 45vw;
        max-width: 800px;
        max-height: 450px;
        border: none;
      }

      .buttons-container {
        display: flex;
        justify-content: space-between;
        position: absolute;
        top: 50%;
        width: 75%;
        padding: 0 10%;
        transform: translateY(-50%);
        z-index: 10;
      }

      .button {
        background-color: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: 10px;
        font-size: 1rem;
        cursor: pointer;
        border-radius: 4px;
        opacity: 0.7;
      }

      .sign {
        font-family: fantasy;
        min-height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;

        span {
          font-size: 4rem;
          text-align: center;
          line-height: 2;
          color: #c6e2ff;
          animation: neon 0.08s ease-in-out infinite alternate;
        }
      }
      /* para que activo windows si ni tengo tiempo para usar la pc :,v */

      @keyframes neon {
        from {
          text-shadow: 0 0 6px rgba(202, 228, 225, 0.92),
            0 0 30px rgba(202, 228, 225, 0.34),
            0 0 12px rgba(30, 132, 242, 0.52), 0 0 21px rgba(30, 132, 242, 0.92),
            0 0 34px rgba(30, 132, 242, 0.78), 0 0 54px rgba(30, 132, 242, 0.92);
        }
        to {
          text-shadow: 0 0 6px rgba(202, 228, 225, 0.98),
            0 0 30px rgba(202, 228, 225, 0.42),
            0 0 12px rgba(30, 132, 242, 0.58), 0 0 22px rgba(30, 132, 242, 0.84),
            0 0 38px rgba(30, 132, 242, 0.88), 0 0 60px rgba(30, 132, 242, 1);
        }
      }

      .card.red-tone::before {
        background-image: linear-gradient(
          45deg,
          #ff0000,
          #ff6347
        ); /* Ejemplo de gradiente rojo */
      }

      .card.red-tone::after {
        background-image: linear-gradient(
          45deg,
          #ff0000,
          #ff6347
        ); /* Ejemplo de gradiente rojo */
      }

      a {
        font-family: "Inconsolata", monospace;

        position: relative;
        display: inline-block;
        padding: 25px 30px;
        margin: 40px;
        font-size: 24px;
        text-decoration: none;
        text-transform: uppercase;
        letter-spacing: 4px;
        transition: 0.5s;
      }

      .btns {
        justify-content: center;
        align-items: center;
        min-height: 90vh;
        flex-direction: row;
      }

      #specialButton {
        display: none;
      }
      .btns a {
        cursor: pointer;
      }

      .pink-btn {
        color: #ff0000;
        border: 4.5px solid #ff0000;
        border-radius: 7px;
      }
      .pink-btn:hover {
        background-color: #ff0000;
        color: #050801;
        box-shadow: 0px 0px 5px #35043b, 0px 0px 25px #0e010f,
          0px 0px 50px #36060e, 0px 0px 100px #27020a;
        -webkit-box-reflect: below 1px linear-gradient(transparent, #0005);
      }
    </style>
  </head>
  <body>
    <div class="sign">
      <span id="author-title">Cargando...</span>
    </div>
    <div id="card-container">
      <div class="card" id="magic-card">
        Cargando...
        <div id="hover-overlay"></div>
      </div>
      <div class="buttons-container">
        <button id="prevButton" class="button">Retroceder</button>
        <button id="nextButton" class="button">Avanzar</button>
      </div>
      <!-- Botón oculto que se mostrará solo cuando el autor sea "Munguia" -->

      <div id="dark-overlay" class="dark-overlay"></div>
      <div id="video-container" class="video-container">
        <iframe id="videoFrame" src="" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>

    <div class="btns" id="specialButton">
      <a class="pink-btn" id="showVideoButton">Llamar a Sofia</a>
    </div>

    <script src="https://apis.google.com/js/api.js"></script>

    <script>
      const API_KEY = "AIzaSyC_I8JUKHONdzKpxsT9f_SLouhv7J8tYCM"; // Reemplaza con tu API Key
      const SPREADSHEET_ID = "12p7ngeRtvTojxrriaH2M6AadfQwSbI6nHgVrAunBZuo"; // Reemplaza con tu ID de hoja de cálculo
      const RANGE = "Sheet1!B:C"; // El rango de las celdas con el autor y el mensaje

      const youtubeRegex =
        /(https?:\/\/(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11}))|(https?:\/\/(www\.)?youtube\.com\/shorts\/([a-zA-Z0-9_-]{11}))/;

      let currentIndex = 0;
      let messages = []; // Aquí almacenamos los mensajes obtenidos de Google Sheets

      const container = document.getElementById("card-container");
      const card = document.getElementById("magic-card");
      const darkOverlay = document.getElementById("dark-overlay");
      const authorTitle = document.getElementById("author-title");
      const showVideoButton = document.getElementById("showVideoButton");

      const videoContainer = document.getElementById("video-container");
      const videoFrame = document.getElementById("videoFrame");

      showVideoButton.addEventListener("click", () => {
        // URL del video de Google Drive
        const videoUrl =
          "https://drive.google.com/file/d/1YAaxLSuEa0OTIqlzgikBfIiqHi4thfNX/preview";

        // Mostrar la capa oscura con una animación de desvanecimiento
        darkOverlay.style.display = "block";
        darkOverlay.style.opacity = 0;
        let opacity = 0;
        const fadeIn = setInterval(() => {
          if (opacity < 1) {
            opacity += 0.025;
            darkOverlay.style.opacity = opacity;
          } else {
            clearInterval(fadeIn);

            setTimeout(() => {
              videoContainer.style.display = "flex"; // Mostrar el contenedor
              videoFrame.src = videoUrl; // Asignar la URL del video
            }, 2000);
          }
        }, 100);
      });

      // // Ocultar el video al hacer clic en la capa oscura
      // darkOverlay.addEventListener("click", () => {
      //   videoContainer.style.display = "none";
      //   darkOverlay.style.display = "none";
      //   videoFrame.src = ""; // Detener el video
      // });

      // Función para aplicar estilos en tonos rojizos
      const applyRedToneStyles = () => {
        const card = document.getElementById("magic-card");
        const cardBefore = document.querySelector(".card::before"); // No se puede acceder directamente a pseudo-elementos, así que usamos una clase CSS

        if (card) {
          // Cambiar colores de la carta
          card.style.background =
            "linear-gradient(to bottom, #ff7f7f, #ff4c4c)";
          card.style.color = "#ffffff"; // Asegurar que el texto sea legible

          // Si deseas cambiar los estilos del pseudo-elemento, asegúrate de hacerlo a través de clases CSS
          // Por ejemplo, agregar una clase `red-tone` que maneje los estilos de `::before` y `::after`
          card.classList.add("red-tone");
        }
      };
      // Función que actualiza el contenido de la carta
      const updateCardContent = () => {
        const text = messages[currentIndex].message; // Obtiene el mensaje
        const match = text.match(youtubeRegex);
        const author = messages[currentIndex].author; // Obtiene el autor del mensaje

        authorTitle.innerHTML = `${author}`;

        if (author === "Munguia") {
          // Aplica los estilos rojos si el autor es "Munguia"
          applyRedToneStyles();
          // Mostrar el botón especial
          if (specialButton) {
            specialButton.style.display = "inline-block"; // Muestra el botón
          }
        } else {
          // Si el autor no es "Munguia", restablece a los colores por defecto
          const card = document.getElementById("magic-card");
          card.style.background = "black";
          card.style.color = "rgb(88 199 250 / 100%)"; // Resetear color de texto
          card.classList.remove("red-tone");
          // Ocultar el botón especial
          if (specialButton) {
            specialButton.style.display = "none"; // Oculta el botón
          }
        }
        if (match) {
          // Si encontramos un video (normal o Shorts)
          const videoId = match[4] || match[7]; // Si es un video normal o un Shorts, tomamos el ID de la coincidencia
          card.innerHTML = `
      <div class="card-text">${text.replace(match[0], "")}</div>
      <iframe 
        src="https://www.youtube.com/embed/${videoId}" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen></iframe>
      <div id="hover-overlay"></div>
    `;
        } else {
          card.innerHTML = `<div class="card-text">${text}</div>`;
        }

        currentIndex = (currentIndex + 1) % messages.length;
      };

      // Función para mostrar el overlay oscuro gradualmente
      const showDarkOverlay = () => {
        let opacity = 0;
        darkOverlay.style.opacity = opacity;
        darkOverlay.style.display = "block"; // Asegurarse de que esté visible

        function fadeIn() {
          opacity += 0.05; // Aumentar la opacidad poco a poco
          darkOverlay.style.opacity = opacity;

          if (opacity < 1) {
            requestAnimationFrame(fadeIn);
          }
        }

        fadeIn();
      };

      // Función para ocultar el overlay oscuro gradualmente
      const hideDarkOverlay = () => {
        let opacity = 1;
        darkOverlay.style.opacity = opacity;

        function fadeOut() {
          opacity -= 0.05; // Disminuir la opacidad poco a poco
          darkOverlay.style.opacity = opacity;

          if (opacity > 0) {
            requestAnimationFrame(fadeOut);
          } else {
            darkOverlay.style.display = "none"; // Ocultar completamente cuando la opacidad sea 0
          }
        }

        fadeOut();
      };

      // Función para cambiar al siguiente mensaje
      const nextMessage = () => {
        showDarkOverlay();
        setTimeout(() => {
          updateCardContent();
          hideDarkOverlay();
        }, 2000);
      };

      // Función para retroceder al mensaje anterior
      const prevMessage = () => {
        showDarkOverlay();
        setTimeout(() => {
          currentIndex = (currentIndex - 2 + messages.length) % messages.length;
          updateCardContent();
          hideDarkOverlay();
        }, 2000);
      };

      document
        .getElementById("nextButton")
        .addEventListener("click", nextMessage);
      document
        .getElementById("prevButton")
        .addEventListener("click", prevMessage);

      // Inicializa la API de Google Sheets
      function initApi() {
        gapi.client
          .init({
            apiKey: API_KEY,
          })
          .then(function () {
            return gapi.client.request({
              path: `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}`,
            });
          })
          .then(function (response) {
            if (response && response.result) {
              const values = response.result.values;
              if (values.length > 0) {
                messages = values.map((row) => ({
                  author: row[0], // Columna A (autor)
                  message: row[1], // Columna B (mensaje)
                }));
                updateCardContent(); // Inicializar con el primer mensaje
              } else {
                console.log("No data found.");
              }
            } else {
              console.log("No response.result recibido.");
            }
          })
          .catch(function (error) {
            console.error("Error al obtener los datos:", error);
          });
      }

      function loadClient() {
        gapi.load("client", initApi);
      }

      loadClient();
    </script>
  </body>
</html>
